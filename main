import subprocess
import time
import sys
import os

# --- CONFIGURATION DES NOMS DE FICHIERS ---
SCRIPT_TRAIN = "1_train_ai"
SCRIPT_SENSOR = "2_sensor_iot"
SCRIPT_DASHBOARD = "3_dashboard"

def verifier_fichiers():
    fichiers = [SCRIPT_TRAIN, SCRIPT_SENSOR, SCRIPT_DASHBOARD]
    manquants = [f for f in fichiers if not os.path.exists(f)]
    if manquants:
        print(f"‚ùå ERREUR : Il manque ces fichiers dans le dossier : {manquants}")
        print("Assure-toi d'avoir enregistr√© les 3 codes pr√©c√©dents avec ces noms exacts.")
        input("Appuie sur Entr√©e pour quitter...")
        sys.exit()

def lancer_script_dans_nouvelle_fenetre(script_name, titre):
    """
    Ouvre une nouvelle fen√™tre de terminal pour ex√©cuter le script.
    Fonctionne sp√©cifiquement pour Windows.
    """
    print(f"üöÄ Lancement de {titre}...")
    # La commande 'start cmd /k' ouvre une nouvelle fen√™tre CMD et la garde ouverte
    # sys.executable assure qu'on utilise le m√™me python (pas d'erreur de path)
    commande = f'start "{titre}" cmd /k "{sys.executable} {script_name}"'
    subprocess.Popen(commande, shell=True)

def main():
    print("==================================================")
    print("   DEMARRAGE DU SYSTEME MICROGRID INTELLIGENT")
    print("==================================================")
    
    verifier_fichiers()

    # ETAPE 1 : L'ENTRAINEMENT (Bloquant)
    # On doit attendre que l'IA soit cr√©√©e avant de lancer le reste
    if not os.path.exists("my_brain.h5"):
        print("‚ö†Ô∏è  Aucune IA d√©tect√©e. Lancement de l'entra√Ænement...")
        print("‚è≥  Veuillez patienter (cela peut prendre 1 √† 2 minutes)...")
        # Ici on utilise call pour bloquer le programme tant que ce n'est pas fini
        subprocess.check_call([sys.executable, SCRIPT_TRAIN])
        print("‚úÖ  Entra√Ænement termin√© !")
    else:
        print("‚úÖ  IA d√©tect√©e (my_brain.h5). On passe √† la suite.")

    time.sleep(1)

    # ETAPE 2 : LE DASHBOARD (Nouvelle fen√™tre)
    # On le lance en premier pour qu'il soit pr√™t √† recevoir
    lancer_script_dans_nouvelle_fenetre(SCRIPT_DASHBOARD, "3. DASHBOARD (CENTRE DE CONTROLE)")
    
    print("‚è≥  Attente de 5 secondes pour l'initialisation du Dashboard...")
    time.sleep(5)

    # ETAPE 3 : LE CAPTEUR (Nouvelle fen√™tre)
    lancer_script_dans_nouvelle_fenetre(SCRIPT_SENSOR, "2. CAPTEUR IOT (SIMULATION)")

    print("\nüéâ  TOUT EST LANCE !")
    print("Check tes barres de t√¢ches, tu as maintenant 2 nouvelles fen√™tres noires.")
    print(" - Une fen√™tre affiche le GRAPHIQUE")
    print(" - Une fen√™tre envoie les DONN√âES")
    print("==================================================")

if __name__ == "__main__":
    main()